import java.io.*;
import java.net.*;
import java.util.*;

/**
 * ChatApp
 * -------
 * Single-file Java multithreaded chat application.
 * Supports both server and client modes.
 */
public class ChatApp {

    private static final int PORT = 1234;
    private static Set<ClientHandler> clients = Collections.synchronizedSet(new HashSet<>());

    public static void main(String[] args) {
        if (args.length == 0) {
            System.out.println("Usage: java ChatApp <server|client>");
            return;
        }

        if (args[0].equalsIgnoreCase("server")) {
            startServer();
        } else if (args[0].equalsIgnoreCase("client")) {
            startClient();
        } else {
            System.out.println("Invalid option. Use 'server' or 'client'.");
        }
    }

    /* ================= SERVER ================= */

    private static void startServer() {
        System.out.println("Chat Server started on port " + PORT
